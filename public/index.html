<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Roblox Rank Reverter</title>
  
  <!-- Poppins font for clean, modern look -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  
  <style>
    /* RESET & BASE */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    body, html {
      margin: 0; padding: 0;
      height: 100%;
      background: linear-gradient(135deg, #0f172a, #1e293b);
      font-family: 'Poppins', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #e0e6f8;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      user-select: none;
      overflow: hidden;
      padding: 20px;
    }
    
    /* CONTAINER */
    .container {
      background: rgba(255 255 255 / 0.05);
      border-radius: 32px;
      padding: 48px 56px;
      width: 420px;
      max-width: 95vw;
      box-shadow: 0 16px 64px rgb(0 0 0 / 0.3);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      display: flex;
      flex-direction: column;
      gap: 30px;
      transition: background 0.3s ease;
    }

    /* TITLE */
    h1 {
      font-weight: 700;
      font-size: 2.5rem;
      letter-spacing: 0.12em;
      color: #60a5fa;
      text-align: center;
      text-shadow: 0 0 10px #3b82f6;
      user-select: text;
    }

    /* INPUTS & SELECT */
    input, select {
      background: rgba(255 255 255 / 0.1);
      border: none;
      outline: none;
      border-radius: 16px;
      padding: 16px 24px;
      font-size: 1.1rem;
      color: #e0e6f8;
      transition: box-shadow 0.3s ease, background-color 0.3s ease;
      box-shadow:
        inset 4px 4px 6px rgb(0 0 0 / 0.4),
        inset -4px -4px 6px rgb(255 255 255 / 0.1);
      cursor: pointer;
      user-select: text;
    }

    input::placeholder {
      color: #94a3b8;
      font-weight: 500;
    }

    input:focus, select:focus {
      background: rgba(255 255 255 / 0.15);
      box-shadow:
        0 0 12px #60a5fa,
        inset 4px 4px 6px rgb(0 0 0 / 0.6),
        inset -4px -4px 6px rgb(255 255 255 / 0.15);
      color: #f8fafc;
    }

    select {
      cursor: pointer;
    }

    /* BUTTONS */
    button {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      border: none;
      border-radius: 24px;
      padding: 18px 36px;
      font-size: 1.15rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      color: white;
      cursor: pointer;
      box-shadow:
        0 8px 15px rgb(59 130 246 / 0.6);
      transition: box-shadow 0.3s ease, transform 0.15s ease;
      user-select: none;
      filter: drop-shadow(0 2px 2px rgb(37 99 235 / 0.7));
    }

    button:hover {
      box-shadow:
        0 12px 24px rgb(37 99 235 / 0.9);
      transform: translateY(-2px);
    }

    button:active {
      transform: translateY(1px);
      box-shadow:
        0 4px 8px rgb(37 99 235 / 0.5);
    }

    /* LOG AREA */
    #log {
      background: rgba(255 255 255 / 0.1);
      border-radius: 24px;
      padding: 20px;
      font-family: 'Fira Mono', monospace, monospace;
      font-size: 0.9rem;
      line-height: 1.4;
      color: #a1aebf;
      min-height: 140px;
      max-height: 200px;
      overflow-y: auto;
      user-select: text;
      box-shadow:
        inset 2px 2px 8px rgb(0 0 0 / 0.6),
        inset -2px -2px 8px rgb(255 255 255 / 0.1);
    }

    /* HIDE SELECTS INITIALLY */
    select {
      display: none;
    }

    /* SHOW SELECT WHEN ACTIVE */
    select.active {
      display: block;
    }

    /* SCROLLBAR FOR LOG */
    #log::-webkit-scrollbar {
      width: 8px;
    }
    #log::-webkit-scrollbar-track {
      background: rgba(255 255 255 / 0.05);
      border-radius: 12px;
    }
    #log::-webkit-scrollbar-thumb {
      background: #2563eb;
      border-radius: 12px;
    }
  </style>
</head>
<body>
  <main class="container" role="main" aria-label="Roblox Rank Reverter">
    <h1>üîÅ Roblox Rank Reverter</h1>

    <input
      id="cookie"
      type="text"
      autocomplete="off"
      spellcheck="false"
      placeholder="üîë Security Cookie"
      aria-label="Security Cookie"
    />

    <input
      id="groupId"
      type="number"
      placeholder="üë• Group ID"
      aria-label="Group ID"
      min="1"
      step="1"
    />

    <select id="currentRankId" aria-label="Current Rank"></select>
    <select id="newRankId" aria-label="New Rank"></select>

    <button id="fetchBtn" type="button" aria-live="polite">üì• Fetch ranks</button>
    <button id="revertBtn" type="button" aria-live="polite">üöÄ Start revert</button>

    <pre id="log" aria-live="polite" role="log" aria-atomic="true"></pre>
  </main>

  <script>
    const fetchBtn = document.getElementById('fetchBtn');
    const revertBtn = document.getElementById('revertBtn');
    const log = document.getElementById('log');
    const currentSelect = document.getElementById('currentRankId');
    const newSelect = document.getElementById('newRankId');

    function showLog(msg) {
      log.textContent = msg;
      log.scrollTop = log.scrollHeight;
    }

    async function fetchRoles() {
      const groupId = document.getElementById('groupId').value.trim();
      if (!groupId) return showLog('‚ö†Ô∏è Please enter a valid Group ID');

      showLog('‚è≥ Fetching ranks...');
      currentSelect.classList.remove('active');
      newSelect.classList.remove('active');
      currentSelect.innerHTML = '';
      newSelect.innerHTML = '';

      try {
        const res = await fetch(`/roles?groupId=${groupId}`);
        const data = await res.json();

        if (!Array.isArray(data)) throw new Error('Invalid data');

        currentSelect.classList.add('active');
        newSelect.classList.add('active');

        currentSelect.innerHTML = '<option disabled selected>üéØ Current rank</option>';
        newSelect.innerHTML = '<option disabled selected>‚Ü©Ô∏è New rank</option>';

        data.forEach((role) => {
          const opt1 = document.createElement('option');
          opt1.value = role.id;
          opt1.textContent = `(${role.rank}) ${role.name}`;
          const opt2 = opt1.cloneNode(true);
          currentSelect.appendChild(opt1);
          newSelect.appendChild(opt2);
        });

        showLog('‚úÖ Ranks fetched! Pick the ranks and start revert.');
      } catch (err) {
        showLog(`üíÄ Error fetching ranks: ${err.message}`);
      }
    }

    async function startRevert() {
      const cookie = document.getElementById('cookie').value.trim();
      const groupId = parseInt(document.getElementById('groupId').value);
      const currentRankId = parseInt(currentSelect.value);
      const newRankId = parseInt(newSelect.value);

      if (!cookie || !groupId || !currentRankId || !newRankId) {
        return showLog('‚ö†Ô∏è Please fill all fields correctly!');
      }

      showLog('‚è≥ Reverting ranks...');

      try {
        const res = await fetch('/revert', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ cookie, groupId, currentRankId, newRankId }),
        });
        const data = await res.json();

        if (data.success) {
          showLog(`‚úÖ Reverted ${data.count} users\n\n${(data.logs || []).join('\n')}`);
        } else {
          showLog(`‚ùå Failed: ${data.error}`);
        }
      } catch (err) {
        showLog(`üí• Backend unreachable: ${err.message}`);
      }
    }

    fetchBtn.addEventListener('click', fetchRoles);
    revertBtn.addEventListener('click', startRevert);
  </script>
</body>
</html>
